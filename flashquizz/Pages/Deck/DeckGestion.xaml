<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="flashquizz.Pages.Deck.DeckGestion"
    xmlns:models="clr-namespace:flashquizz.Models"
    NavigationPage.HasNavigationBar="False">

    <Grid RowDefinitions="80,*">

        <!-- nav custom -->
        <Grid Grid.Row="0" HeightRequest="80">

            <BoxView Color="Black" />
            <Image Source="navd.png" Aspect="AspectFit" HeightRequest="80"/>
            <Image Source="orc.gif"
                   HeightRequest="80"
                   Aspect="AspectFit"
                   IsAnimationPlaying="True"
                   Margin="300,0,0,0"/>

            <Label 
                TextColor="#FFD700"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                VerticalOptions="Center"/>

            <ImageButton
                Source="backarrow.png"
                HeightRequest="80"
                WidthRequest="80"
                Margin="15,0"
                HorizontalOptions="Start"
                VerticalOptions="Center"
                Clicked="OnBackClicked"/>
        </Grid>

        <!-- contenu de la page -->
        <Grid Grid.Row="1">
            <BoxView Color="Black" InputTransparent="True"/>

            <Image Source="bgmap.jfif" Aspect="AspectFill" Opacity="0.6" InputTransparent="True"/>
            
            <!-- Overlay dégradé en haut seulement -->
            <BoxView HeightRequest="200" VerticalOptions="Start" InputTransparent="True">
                <BoxView.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#FF000000" Offset="0.0" />
                        <GradientStop Color="#00000000" Offset="1.0" />
                    </LinearGradientBrush>
                </BoxView.Background>
            </BoxView>

            <Grid Padding="20" RowDefinitions="Auto,Auto,*" RowSpacing="20">
                <Label Text="Gérer les decks" 
                       FontSize="32"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="#FFD700"
                       HorizontalTextAlignment="Center"/>

                <Button x:Name="DeckAddBtn"
                        Text="+"
                        Clicked="OnClickedAddDeck"
                        BackgroundColor="#2A2A2A"
                        TextColor="#FFD700"
                        FontSize="20"
                        Margin="0,60,0,0"
                        HeightRequest="50"
                        WidthRequest="50"
                        CornerRadius="80"
                        BorderColor="#FFD700"
                        BorderWidth="3"
                        HorizontalOptions="Center"
                        Opacity="0.8"/>
                
                <CollectionView x:Name="DeckCollection"
                                Grid.Row="2"
                                ItemsSource="{Binding Decks}"
                                SelectionMode="Single"
                                SelectionChanged="OnDeckSelected">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Deck">
                            <SwipeView SwipeStarted="OnSwipeStarted" SwipeEnded="OnSwipeEnded">
                                <SwipeView.RightItems>
                                    <SwipeItems Mode="Reveal">
                                        <SwipeItem Text="Supprimer"
                                                   BackgroundColor="#8B0000"
                                                   IconImageSource="trash.png"
                                                   Invoked="OnDeleteDeck"
                                                   CommandParameter="{Binding .}" />
                                    </SwipeItems>
                                </SwipeView.RightItems>

                                <Frame BackgroundColor="#2A2A2A"
                                       BorderColor="#FFD700"
                                       CornerRadius="8"
                                       Padding="15"
                                       Margin="0,5"
                                       Opacity="0.85">
                                    <Label Text="{Binding Title}"
                                           TextColor="#FFD700"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           HorizontalTextAlignment="Center"/>
                                </Frame>
                            </SwipeView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>
